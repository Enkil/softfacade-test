<!-- AstraMediaGroup Outdate browsers modal-->
<div role="alert" id="amg-outdate-wrapper" class="amg-outdate-wrapper">
  <section role="article" class="amg-outdate">
    <button role="button" aria-label="Close" title="Закрыть" id="amg-outdate__close" class="amg-outdate__close">
      <svg id="layer-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21.4 21.4">
        <style>
          .amg-cross {
            fill-rule: evenodd;
            clip-rule: evenodd;
          }
        </style>
        <path class="amg-cross" d="M20.7 0l.7.7L.8 21.4l-.7-.7L20.7 0z" />
        <path class="amg-cross" d="M.7 0L0 .7l20.6 20.6.7-.7L.7 0z" /> </svg>
    </button>
    <h2 class="amg-outdate__title">Ваш браузер<span class="amg-outdate__title-more"> может больше</span></h2>
    <p class="amg-outdate__text">Команда Astra Media Group постаралась сделать сайт
      <br> удобным, понятным и красивым.</p>
    <p class="amg-outdate__text">Однако используемая вами версия браузера
      <br> может неправильно отображать сайты
      <br> и портить вам удовольствие от работы.</p>
    <p class="amg-outdate__text">Установите более современный браузер.
      <br> Это бесплатно и займет всего пару минут.</p>
    <p class="amg-outdate__text">После этого вы заметите, что интернет стал лучше!</p>
    <div class="amg-outdate__browsers-stack">
      <a href="https://www.google.ru/chrome/browser/desktop/" target="_blank" title="Установите последнюю версию браузера Google Chrome" data-browser="chrome" class="amg-outdate__browser"><img src="img/chrome-logo.png" alt="Установите последнюю версию браузера Google Chrome" class="amg-outdate__browser-logo" /><span class="amg-outdate__browser-name">Chrome</span></a>
      <a href="http://www.opera.com/ru" target="_blank" title="Установите последнюю версию браузера Opera"
      data-browser="opera" class="amg-outdate__browser"><img src="img/opera-logo.png" alt="Установите последнюю версию браузера Opera" class="amg-outdate__browser-logo" /><span class="amg-outdate__browser-name">Opera</span></a>
      <a href="http://windows.microsoft.com/ru-ru/internet-explorer/download-ie"
      target="_blank" title="Установите последнюю версию браузера Microsoft Internet Explorer" data-browser="msie" class="amg-outdate__browser"><img src="img/explorer-logo.png" alt="Установите последнюю версию браузера Microsoft Internet Explorer" style="width" class="amg-outdate__browser-logo" /><span class="amg-outdate__browser-name">IE/Edge</span></a>
      <a href="https://www.mozilla.org/ru/firefox/new/"
      target="_blank" title="Установите последнюю версию браузера Mozilla Firefox" data-browser="mozilla" class="amg-outdate__browser"><img src="img/firefox-logo.png" alt="Установите последнюю версию браузера Mozilla Firefox" class="amg-outdate__browser-logo" /><span class="amg-outdate__browser-name">Firefox</span></a>
      <a href="https://support.apple.com/downloads/safari" target="_blank"
      title="Установите последнюю версию браузера Apple Safari" data-browser="safari" class="amg-outdate__browser"><img src="img/safari-logo.png" alt="Установите последнюю версию браузера Apple Safari" class="amg-outdate__browser-logo" /><span class="amg-outdate__browser-name">Safari</span></a>
    </div>
    <button role="button" title="Закрыть" id="amg-outdate__btn-thx" class="amg-outdate__btn-thx">Спасибо, меня все устраивает</button>
    <!-- AstraMediaGroup Outdate browsers modal scripts-->
  </section>
  <script>
    /**
     * Detect browser, browser version and OS
     *
     * @class
     * @name detectBrowser
     * @version 1.0.0
     * @author Igor Timohin <timohin.i@gmail.com>
     * @copyright Igor Timohin 2015
     *
     * @example
     * userBrowserIs = new detectBrowser();
     * console.log(userBrowserIs.getBrowser()); // chrome
     * console.log(userBrowserIs.getOS()); // mac
     * console.log(userBrowserIs.getVersion()); // 45
     * */
    var detectBrowser = function()
    {
      /**
       * @name detectBrowser#that
       * @type {detectBrowser}
       */
      var that = this;
      /**
       * Get browser UserAgent
       * @var
       * @type {string}
       */
      var _ua = window.navigator.userAgent;
      /**
       * Search browser identities in UserAgent string
       * @constant
       * @type {{opera: boolean, msie: boolean, msie6: boolean, msie7: boolean, msie8: boolean, msie9: boolean, mozilla: boolean, chrome: boolean, safari: boolean, msie_mobile: boolean, safari_mobile: boolean, opera_mobile: boolean, opera_mini: boolean, search_bot: boolean}}
       */
      var browser = {
        opera: (/opera/i.test(_ua) || /opr/i.test(_ua)),
        msie: (/msie/i.test(_ua) && !/opera/i.test(_ua) || /trident\//i.test(_ua)),
        msie6: (/msie 6/i.test(_ua) && !/opera/i.test(_ua)),
        msie7: (/msie 7/i.test(_ua) && !/opera/i.test(_ua)),
        msie8: (/msie 8/i.test(_ua) && !/opera/i.test(_ua)),
        msie9: (/msie 9/i.test(_ua) && !/opera/i.test(_ua)),
        mozilla: /firefox/i.test(_ua),
        chrome: (!((/opera/i.test(_ua) || /opr/i.test(_ua))) && /chrome/i.test(_ua)),
        safari: (!(/chrome/i.test(_ua)) && /webkit|safari|khtml/i.test(_ua)),
        msie_mobile: /iemobile/i.test(_ua),
        safari_mobile: /iphone|ipod|ipad/i.test(_ua),
        opera_mobile: /opera mini|opera mobi/i.test(_ua),
        opera_mini: /opera mini/i.test(_ua),
        search_bot: /(yandex|google|stackrambler|aport|slurp|msnbot|bingbot|twitterbot|ia_archiver|facebookexternalhit)/i.test(_ua)
      };
      /**
       * Search browser version identities in UserAgent string
       * @constant
       * @type {{version: *}}
       */
      var versions = {
        version: (_ua.match(/.+(?:me|ox|on|rv|it|era|opr|ie|msie)[\/: ]([\d.]+)/) || [0, '0'])[1]
      };
      /**
       * Search OS identities in UserAgent string
       * @constant
       * @type {{mac: boolean, iphone: boolean, ipod: boolean, iphone4: boolean, ipod4: boolean, ipad: boolean, android: boolean, bada: boolean, mobile: boolean}}
       */
      var os = {
        mac: /mac/i.test(_ua),
        iphone: /iphone/i.test(_ua),
        ipod: /ipod/i.test(_ua),
        iphone4: /iphone.*OS 4/i.test(_ua),
        ipod4: /ipod.*OS 4/i.test(_ua),
        ipad: /ipad/i.test(_ua),
        android: /android/i.test(_ua),
        bada: /bada/i.test(_ua),
        mobile: /iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(_ua)
      };
      /**
       * Return user browser name
       * @returns {string}
       * @name detectBrowser#getBrowser
       */
      that.getBrowser = function()
      {
        for (var browserIs in browser)
        {
          if (browser[browserIs] == true)
          {
            return browserIs;
          }
        }
      };
      /**
       * Return user browser version
       * @returns {string}
       * @name detectBrowser#getVersion
       */
      that.getVersion = function()
      {
        /**
         * IE version is not correctly provides and we get 0. If it is so - run second check (else)
         */
        if (versions.version != 0)
        {
          return versions.version.split('.')[0];
        }
        else
        {
          var ieVersion = -1; // Return value assumes failure.
          if (navigator.appName == 'Microsoft Internet Explorer')
          {
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(_ua) != null) ieVersion = parseFloat(RegExp.$1);
          }
          return ieVersion;
        }
      };
      /**
       * Return user OS name
       * @returns {string}
       * @name detectBrowser#getOS
       */
      that.getOS = function()
      {
        for (var osIs in os)
        {
          if (os[osIs] == true)
          {
            return osIs;
          }
          else
          {
            var _up = window.navigator.platform;
            return _up;
          }
        }
      }
    };
    var userBrowserIs = new detectBrowser();
    /**
     * Check if user browser is MS IE 7 and define document.querySelector & document.querySelectorAll for IE7
     *
     * @class
     * @name ifIE7querySelector
     * @author Moritz Schmidt https://github.com/Fusselwurm
     *
     * @example
     * ifIE7querySelector();
     */
    var ifIE7querySelector = function()
    {
      if (userBrowserIs.getBrowser() == 'msie' && userBrowserIs.getVersion() == '7')
      {
        /**
         * define document.querySelector & document.querySelectorAll for IE7
         *
         * Taked from https://gist.github.com/Fusselwurm/4673695
         *
         * A not very fast but small hack. The approach is taken from
         * http://weblogs.asp.net/bleroy/archive/2009/08/31/queryselectorall-on-old-ie-versions-something-that-doesn-t-work.aspx
         *
         */
        (function()
        {
          var style = document.createStyleSheet(),
            select = function(selector, maxCount)
            {
              var all = document.all,
                l = all.length,
                i,
                resultSet = [];
              style.addRule(selector, "foo:bar");
              for (i = 0; i < l; i += 1)
              {
                if (all[i].currentStyle.foo === "bar")
                {
                  resultSet.push(all[i]);
                  if (resultSet.length > maxCount)
                  {
                    break;
                  }
                }
              }
              style.removeRule(0);
              return resultSet;
            };
          //  be rly sure not to destroy a thing!
          if (document.querySelectorAll || document.querySelector)
          {
            return;
          }
          document.querySelectorAll = function(selector)
          {
            return select(selector, Infinity);
          };
          document.querySelector = function(selector)
          {
            return select(selector, 1)[0] || null;
          };
        }());
      }
    }
    ifIE7querySelector();
    /**
     * Get outdate browser link in AMG modal cap and set up css class to it
     *
     * @class
     * @name getOutDateBrowserLink
     * @version 1.0.0
     * @author Igor Timohin <timohin.i@gmail.com>
     * @requires detectBrowser
     *
     * @param {string} browserLinksClass - CSS class off browsers links
     * @param {string} classToAdd - CSS class, which will be added to user current browsers link
     * @param {string} dataset - data-attribute of browsers links with browsers name, to compare current user browser and browsers link
     * @param {string } capWrapper - Modal wrapper
     * @param {string } classToBodyAdd - CSS class which added to document.body when modal opened
     *
     * @example
     * setUpLink = new getOutDateBrowserLink();
     */
    var getOutDateBrowserLink = function(browserLinksClass, classToAdd, dataset, capWrapper, classToBodyAdd)
    {
      browserLinksClass = browserLinksClass || '.amg-outdate__browser';
      classToAdd = classToAdd || ' amg-outdate__browser--isUsed';
      dataset = dataset || 'data-browser';
      capWrapper = capWrapper || 'amg-outdate-wrapper';
      classToBodyAdd = classToBodyAdd || 'amg-outdate-modal-opened';
      var browser = new RegExp('chrome|opera|mozilla|msie', 'i'),
        version = new RegExp('^6{1}|^7{1}|^8{1}|^9{1}|^38{1}|^39{1}|^40{1}');
      var modalWrapper = document.getElementById(capWrapper),
        documentBody = document.body;
      /**
       * Test browser and version and show modal if needed
       */
      if (userBrowserIs.getBrowser() == 'safari' && userBrowserIs.getVersion() == '7')
      {
        modalWrapper.style.display = 'block';
        documentBody.className += (' ' + classToBodyAdd);
      }
      else if (browser.test(userBrowserIs.getBrowser()) && version.test(userBrowserIs.getVersion()))
      {
        modalWrapper.style.display = 'block';
        documentBody.className += (' ' + classToBodyAdd);
      }
      var browserLinks = document.querySelectorAll(browserLinksClass);
      /**
       * Check which browser link mateches current users browser and add special CSS class to it
       */
      if (browserLinks.length)
      {
        for (var i = 0; i < browserLinks.length; i++)
        {
          if (browserLinks[i].getAttribute(dataset) == userBrowserIs.getBrowser())
          {
            browserLinks[i].className += (' ' + classToAdd);
          }
        }
      }
    }
    getOutDateBrowserLink();
    /**
     * Set current user browser link to browserStack block center
     *
     * @class
     * @name buildBrowserStack
     * @version 1.0.0
     * @author Igor Timohin <timohin.i@gmail.com>
     * @requires getOutDateBrowserLink
     *
     * @param {string} browserLinksClass - CSS class to find all browsers link
     * @param {string} classToCheck - CSS class to check current browser (this class placed by getOutDateBrowserLink.js)
     * @param {string} browsersStackClass - CSS class to find browsersStack
     *
     * @example
     * buildBrowserStack();
     */
    var buildBrowserStack = function(browserLinksClass, classToCheck, browsersStackClass)
    {
      browserLinksClass = browserLinksClass || '.amg-outdate__browser';
      classToCheck = classToCheck || 'amg-outdate__browser--isUsed';
      browsersStackClass = browsersStackClass || '.amg-outdate__browsers-stack';
      var browsersStack = document.querySelector(browsersStackClass);
      var browsersLinks = document.querySelectorAll(browserLinksClass);
      if (browsersLinks.length)
      {
        /**
         * Go throw browsersLinks and find link with classToCheck, than cache it position in browserLinksClass
         */
        for (i = 0; i < browsersLinks.length; i++)
        {
          if (browsersLinks[i].className.match(new RegExp('(\\s|^)' + classToCheck + '(\\s|$)')))
          {
            var browsersLinkPosition = i;
          }
        }
        /**
         * Cache current position if outdate browser link and IE link (before IE link is in center by default)
         */
        var browsersLinksCurrent = browsersLinks[browsersLinkPosition];
        var browsersLinksIE = browsersLinks[2];
        /**
         * Set new position of outdate browser link and IE link
         */
        if (browsersLinkPosition < 2)
        {
          browsersStack.replaceChild(browsersLinksCurrent, browsersLinksIE);
          browsersStack.insertBefore(browsersLinksIE, browsersLinks[0])
        }
        else if (browsersLinkPosition > 2)
        {
          browsersStack.replaceChild(browsersLinksCurrent, browsersLinksIE);
          browsersStack.appendChild(browsersLinksIE);
        }
        else
        {
          // do nothing
        }
      }
    }
    buildBrowserStack();
    /**
     * Close AstraMediaGroup outdade browsers modal
     *
     * @class
     * @name closeAMGOutdateBrowserModal
     * @version 1.0.0
     * @author Igor Timohin <timohin.i@gmail.com>
     *
     * @param {string} cross - CSS class of Cross icon in head of modal
     * @param {string} btn - CSS class of "Thanks" text-btn in modal footer
     * @param {string} capWrapper - CSS class of Modal wrapper
     * @param {string} classFromBodyRemove - CSS class, which need to remobe from body tag when close modal
     *
     * @example
     * closeAMGOutdateBrowserModal();
     */
    var closeAMGOutdateBrowserModal = function(cross, btn, capWrapper, classFromBodyRemove)
    {
      cross = cross || "amg-outdate__close";
      btn = btn || "amg-outdate__btn-thx";
      capWrapper = capWrapper || "amg-outdate-wrapper";
      classFromBodyRemove = classFromBodyRemove || 'amg-outdate-modal-opened';
      /**
       * @param {string} modalCross - Cross icon in head of modal
       * @param {string} modalBtn - "Thanks" text-btn in modal footer
       * @param {string} modalWrapper - Modal wrapper
       * @param {string} documentBody - body html tag
       * @param {RegExp} removeClassRegExp - RegExp for removing CSS class
       */
      var modalCross = document.getElementById(cross),
        modalBtn = document.getElementById(btn),
        modalWrapper = document.getElementById(capWrapper),
        documentBody = document.body,
        removeClassRegExp = new RegExp("(^|\\s)" + classFromBodyRemove + "(\\s|$)", "g");
      // Hide modal and remove CSS class from body by click on cross
      modalCross.onclick = function()
      {
        modalWrapper.style.display = "none";
        documentBody.className = documentBody.className.replace(removeClassRegExp, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "")
      };
      // Hide modal and remove CSS class from body by click on "Thanx" text-button
      modalBtn.onclick = function()
      {
        modalWrapper.style.display = "none";
        documentBody.className = documentBody.className.replace(removeClassRegExp, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "")
      };
      // Hide modal and remove CSS class from body by pressing Esc keyboard button
      document.onkeydown = function(event)
      {
        events = event || window.event;
        if (event.keyCode == 27)
        {
          modalWrapper.style.display = "none";
          documentBody.className = documentBody.className.replace(removeClassRegExp, "$1").replace(/\s+/g, " ").replace(/(^ | $)/g, "")
        }
      };
    }
    closeAMGOutdateBrowserModal();
  </script>
</div>